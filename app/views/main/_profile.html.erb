<%= stylesheet_link_tag 'profile', media: 'all', 'data-turbolinks-track': 'reload' %>

<div id="profile">
  <div id="alert"></div>
  <form name="userForm" class="feedback-form-1" id="userForm" onsubmit="send_form();return false">
    <div id="sections">
      <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
      <div id="left_section">
        <span><%= @current_user.role.name %> из <%= @company.name %></span><br>
        <span>activate</span><br>
        <% if @current_user.avatar.attached? %>
          <a href="#win1">
          <img src="<%= @current_user.avatar.url %>" id="img">
          </a>
        <% else %>
          <a href="#win1">
          <img src="../assets/avatar1.jpeg" id="img" href="#win1">
          </a>
        <% end %>
      </div>
      <div id="right_section">
        <input type="text" name="name" value="<%= @current_user.name %>" placeholder="Имя"
               class="some-input" required  maxlength="50">
        <input type="text" name="surname" value="<%= @current_user.surname %>" placeholder="Фамилия"
               class="some-input" required  maxlength="50"><br>
        <input type="text" name="mood" value="<%= @current_user.mood %>" id="mood" placeholder="Статус"
               class="some-input" maxlength="50">
        <img src="../assets/emoji.svg" onclick="show_emojis('emoji')">
        <br>
        <%time = ((Time.current - @current_user.created_at)/60/60/24).round - 1 %>
        <% if time < 30 && time_m = 0 %>
          <span>в crm более <%= time %> days</span><br>
        <% elsif time < 365 %>
          <span>в crm более <%= time/30 %> month</span><br>
        <% else  %>
          <span>в crm более <%= time/30/365 %> years</span><br>
        <% end %>
        <textarea class="some-input" name="info" placeholder="О себе...." maxlength="300" cols="30"
                  rows="5" id="some-input"><%= @current_user.info.strip %></textarea>
        <br>
        <img src="../assets/gmail.svg" class="some-img"><input type="text" value="<%= @current_user.email %>"
                                                               class="some-input" readonly title="email"><br>
        <% if @current_user.contacts.present? %>
          <% JSON.parse(@current_user.contacts).each do |contact| %>
            <% if contact.last.present? %>
              <img src="../assets/<%= @contacts.include?(contact.first) ? contact.first : 'another' %>.svg"
                   title="<%= contact.first %>" class="some-img">
              <input type="text"  value="<%= contact.last %>" class="some-input" readonly><br>
            <% end %>
          <% end %>
        <% end %>
        <input type="text" list="contact" placeholder="Контакты" name="contact" autocomplete="off" class="text-input"/>
        <datalist id="contact">
          <% @contacts.each do |contact| %>
            <option ><%= contact %></option>
          <% end %>
        </datalist>
        <input type="text" name="value" maxlength="30" class="text-input" placeholder="Значение">
        <div class="submit submit-with-social" id="am_but">
          <button name="submit_login" id="menu3" class="log" type="submit">
            <span class="menu_text" id="menu_text3">Сохранить<b></b><b></b></span>
          </button>
        </div>
      </div>
    </div>
  </form>
  <div id="emoji" class="hidden"></div>
</div>
<!--------------------------------------------------------------------------------------------------------------------->
<div class="dm-overlay" id="win1">
  <div class="dm-table">
    <div class="dm-cell">
      <div class="dm-modal">
        <a href="#close" class="close"></a>
        <div>
          <form method="post" action="/update_avatar" enctype="multipart/form-data">
            <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
            <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
            <div class="example-1">
              <div class="form-group">
                <label class="label">
                  <i class="material-icons">attach_file</i>
                  <span class="title">Выбрать файл</span>
                  <input type="file"name="avatar" id="avatar">
                </label>
              </div>
            </div>
            <input type="submit" value="Изменить" id="but_avatar">
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
    function hidden_block(name) {
        document.getElementById('main').innerHTML = ""
        document.getElementById('main').innerHTML = document.getElementById(name).innerHTML ;
    }

    let emojis_emotions = [ 0x1F600, 0x1F609, 0x1F601, 0x1F606,0x1F605, 0x1F602, 0x1F923, 0x1F60A, 0x1F642, 0x1F604, 0x1F643,
        0x1F607, 0x1F603, 0x1F61A, 0x1F970, 0x1F619, 0x1F60D, 0x1F617, 0x1F618, 0x1F929, 0x1F60B, 0x1F61B,
        0x1F61C, 0x1F92A, 0x1F61D, 0x1F911, 0x1F914, 0x1F92D, 0x1F917, 0x1F92B, 0x1F610, 0x1F636, 0x1F928, 0x1F62C, 0x1F60F, 0x1F611,
        0x1F612, 0x1F644, 0x1F910, 0x1F925, 0x1F60C, 0x1F614, 0x1F62A, 0x1F634, 0x1F924, 0x1F976, 0x1F927, 0x1F637, 0x1F92F, 0x1F974,
        0x1F635, 0x1F912, 0x1F975, 0x1F92E, 0x1F915, 0x1F922, 0x1F920, 0x1F973, 0x1F913, 0x1F60E, 0x1F9D0, 0x1F615, 0x1F616, 0x1F627, 0x1F97A,
        0x1F62B, 0x1F631, 0x1F61E, 0x1F62F, 0x1F62E, 0x1F62D, 0x1F61F, 0x1F613, 0x1F629, 0x1F622, 0x1F632, 0x1F628, 0x2620, 0x1F633, 0x1F641,
        0x1F625, 0x1F623, 0x1F626, 0x1F630, 0x1F624, 0x1F608, 0x1F621, 0x1F480, 0x1F47F, 0x1F92C, 0x1F620, 0x1F4A9, 0x1F921,
        0x1F916, 0x1F47D, 0x1F47E, 0x1F47B, 0x1F47A, 0x1F479, 0x1F640, 0x1F63D, 0x1F638, 0x1F63F, 0x1F63E, 0x1F63B, 0x1F63A, 0x1F63C, 0x1F639,
        0x1F649, 0x1F64A, 0x1F648
    ];

    let emojis_peoples = [ 0x1F91A, 0x1F596, 0x1F44B, 0x1F590, 0x270B, 0x1F919, 0x1F91E, 0x1F91F, 0x1F918, 0x1F44C, 0x270C,
        0x1F595, 0x1F446, 0x1F447, 0x1F448, 0x1F449, 0x261D, 0x1F91B, 0x1F91C, 0x1F44D, 0x270A, 0x1F44A, 0x1F44E, 0x1F450,
        0x1F91D, 0x1F44F, 0x1F932, 0x1F64F, 0x1F64C, 0x270D, 0x1F933, 0x1F485, 0x1F441, 0x1F444, 0x1F445,
        0x1F442, 0x1F443, 0x1F9B4, 0x1F440, 0x1F9B6, 0x1F9B5, 0x1F9B7, 0x1F4AA, 0x1F9E0, 0x1F9D3, 0x1F9D1, 0x1F9D2, 0x1F469,
        0x1F466, 0x1F467, 0x1F468, 0x1F471, 0x1F476, 0x1F474, 0x1F475, 0x1F9D4, 0x1F64B, 0x1F64D, 0x1F647, 0x1F64E,
        0x1F926, 0x1F646, 0x1F481, 0x1F937, 0x1F645, 0x1F472, 0x1F477, 0x1F482, 0x1F9D5, 0x1F575, 0x1F478, 0x1F473,
        0x1F470, 0x1F46E, 0x1F931, 0x1F930, 0x1F934, 0x1F935, 0x1F9DB, 0x1F9DA, 0x1F385, 0x1F9DE, 0x1F9D9, 0x1F47C, 0x1F9DC,
        0x1F9DD, 0x1F936, 0x1F9DF, 0x1F9B9, 0x1F9B8, 0x1F574,  0x1F486, 0x1F487, 0x1F483, 0x1F46F, 0x1F57A, 0x1F3C3,
        0x1F6B6, 0x1F9D7, 0x1F9D6, 0x1F939, 0x1F938, 0x1F93A, 0x1F93C, 0x1F93E, 0x1F6A3, 0x1F6B5, 0x1F6B4, 0x1F93D,
        0x26F7, 0x1F3CB, 0x26F9, 0x1F3CC, 0x1F3C2, 0x1F3C7, 0x1F3CA, 0x1F3C4, 0x1F9D8, 0x1F6CC, 0x1F6C0, 0x1F48F, 0x1F46C,
        0x1F46A, 0x1F46D, 0x1F46B, 0x1F491, 0x1F464, 0x1F463, 0x1F5E3, 0x1F465
    ];

    let emojis_simvols = [ 0x1F5EF, 0x1F573, 0x1F5E8, 0x1F9E1, 0x1F49F, 0x1F4AD, 0x1F49E, 0x1F48C, 0x1F5A4,
        0x1F4A2, 0x1F493, 0x1F4AF, 0x1F495, 0x1F48B, 0x1F4A8, 0x1F4A6, 0x1F4AB, 0x1F497, 0x1F494, 0x1F498, 0x1F49A, 0x1F499,
        0x1F49C, 0x1F49B, 0x1F4A5, 0x1F4A5, 0x1F4AC, 0x1F4A3, 0x1F4A4, 0x2764, 0x2763, 0x1F49D, 0x267F, 0x1F6BC, 0x1F6BB, 0x1F6BA,
        0x1F6B9, 0x1F6AE, 0x1F6B0, 0x1F3E7, 0x1F6C5, 0x1F6C4, 0x1F6C3, 0x1F6C2, 0x1F6BE, 0x2622, 0x26A0, 0x2623, 0x1F6B7, 0x1F6B3,
        0x1F6B8, 0x26D4, 0x1F4F5, 0x1F6AB, 0x1F6B1, 0x1F6AF, 0x1F6AD, 0x1F51E, 0x2194, 0x21A9, 0x2195, 0x2196, 0x2197, 0x2198,
        0x21AA, 0x2199, 0x1F51D, 0x1F503, 0x2B07, 0x1F51A, 0x1F519, 0x1F51C, 0x1F51B, 0x2B05, 0x2B06, 0x2935, 0x2934, 0x27A1,
        0x1F504, 0x269B, 0x1F52F, 0x271D, 0x262A, 0x2626, 0x262F, 0x262E, 0x1F54E, 0x1F6D0, 0x1F549, 0x2721, 0x2638, 0x2649, 0x264B,
        0x2650, 0x2651, 0x264F, 0x2652, 0x2653, 0x264D, 0x2648, 0x264C, 0x264E, 0x26CE, 0x264A, 0x1F4F3, 0x25B6, 0x23F8, 0x25C0,
        0x23EF, 0x23E9, 0x23EA, 0x23EE, 0x23EB, 0x23EC, 0x23FA, 0x23ED, 0x1F4F4, 0x1F505, 0x1F506, 0x1F501, 0x1F502, 0x1F3A6,
        0x1F500, 0x1F53C, 0x1F53D, 0x23F9, 0x23CF, 0x1F4F6, 0x26A7, 0x2640, 0x2642, 0x2795, 0x2796, 0x2797, 0x267E, 0x2716,
        0x2049, 0x3030, 0x2753, 0x2754, 0x2755, 0x2757, 0x203C, 0x1F4B1, 0x1F4B2, 0x274C, 0x2B55, 0x274E, 0x00AE, 0x2122, 0x267B,
        0x27B0, 0x2611, 0x1F530, 0x1F531, 0x2705, 0x27BF, 0x00A9, 0x303D, 0x2695, 0x2714, 0x269C, 0x1F4DB, 0x2734, 0x2747, 0x2733,
        0x1F51F, 0x1F22F, 0x1F232, 0x1F21A, 0x1F233, 0x3299, 0x1F239, 0x1F19A, 0x1F199, 0x1F201, 0x1F520, 0x1F234, 0x1F170, 0x1F193,
        0x1F235, 0x1F198, 0x1F194, 0x1F18E, 0x1F521, 0x1F195, 0x1F238, 0x1F250, 0x1F251, 0x1F23A, 0x1F196, 0x1F197, 0x2139, 0x1F236,
        0x3297, 0x1F237, 0x1F191, 0x1F202, 0x1F522, 0x1F17F, 0x1F524, 0x1F17E, 0x1F192, 0x1F171, 0x24C2, 0x1F523, 0x1F534, 0x26AB,
        0x26AA, 0x1F535, 0x1F536, 0x1F537, 0x25FC, 0x25AB, 0x25FB, 0x25AA, 0x1F53B, 0x1F53A, 0x1F533, 0x25FD, 0x1F532, 0x25FE,
        0x1F539, 0x1F538, 0x1F518, 0x1F4A0, 0x2B1C, 0x2B1B, 0x1F3F3, 0x1F38C, 0x1F3C1, 0x1F3F4, 0x1F6A9
    ];

    let emojis_animals = [ 0x1F43F, 0x1F42E, 0x1F42D, 0x1F42B, 0x1F42A, 0x1F42F, 0x1F98F, 0x1F98D, 0x1F98C, 0x1F98A, 0x1F992, 0x1F400,
        0x1F428, 0x1F998, 0x1F987, 0x1F40E, 0x1F410, 0x1F40F, 0x1F412, 0x1F411, 0x1F415, 0x1F416, 0x1F417, 0x1F993, 0x1F431,
        0x1F99B, 0x1F430, 0x1F99D, 0x1F429, 0x1F994, 0x1F401, 0x1F404, 0x1F435, 0x1F406, 0x1F405, 0x1F407, 0x1F408, 0x1F984, 0x1F418,
        0x1F403, 0x1F434, 0x1F402, 0x1F436, 0x1F437, 0x1F9A1,  0x1F999, 0x1F439,
        0x1F43D, 0x1F43E, 0x1F43C, 0x1F43B, 0x1F43A, 0x1F981,
    ];

    function show_emojis(name) {
        document.getElementById(name).classList.toggle("hidden");
    }

    let name = new Array();
    name = ["emoji", "emoji2"]

    for (j=0; j<2; j++) {
      document.getElementById(name[j]).innerHTML += "Эмоции <br>"
      emojis_emotions.forEach(function(item, i, arr) {
          document.getElementById(name[j]).innerHTML += `<span class="emoji" onclick="add_emoji_emotions(${i}, ${j});">`
              + String.fromCodePoint(item) + "</span>";
          if (i % 10 == 9) {
              document.getElementById(name[j]).innerHTML += "<br>"
          }
      });

      document.getElementById(name[j]).innerHTML += "<br>Люди и жесты <br>"
      emojis_peoples.forEach(function(item, i, arr) {
          document.getElementById(name[j]).innerHTML += `<span class="emoji" onclick="add_emojis_peoples(${i}, ${j});">`
              + String.fromCodePoint(item) + "</span>";
          if (i % 10 == 9) {
              document.getElementById(name[j]).innerHTML += "<br>"
          }
      });

      document.getElementById(name[j]).innerHTML += "<br>Символы <br>"
      emojis_simvols.forEach(function(item, i, arr) {
          document.getElementById(name[j]).innerHTML += `<span class="emoji" onclick="add_emojis_simvols(${i}, ${j});">`
              + String.fromCodePoint(item) + "</span>";
          if (i % 10 == 9) {
              document.getElementById(name[j]).innerHTML += "<br>"
          }
      });

      document.getElementById(name[j]).innerHTML += "<br>Животные и растения <br>"
      emojis_animals.forEach(function(item, i, arr) {
          document.getElementById(name[j]).innerHTML += `<span class="emoji" onclick="add_emojis_animals(${i}, ${j});">`
              + String.fromCodePoint(item) + "</span>";
          if (i % 10 == 9) {
              document.getElementById(name[j]).innerHTML += "<br>"
          }
      });
    }

    function add_emoji_emotions(i, n) {
        let id = new Array();
        id = ['mood', 'message_input']
        document.getElementById(id[n]).value += String.fromCodePoint(emojis_emotions[i])
    }

    function add_emojis_peoples(i, n) {
        let id = new Array();
        id = ['mood', 'message_input']
        document.getElementById(id[n]).value += String.fromCodePoint(emojis_peoples[i])
    }

    function add_emojis_simvols(i, n) {
        let id = new Array();
        id = ['mood', 'message_input']
        document.getElementById(id[n]).value += String.fromCodePoint(emojis_simvols[i])
    }

    function add_emojis_animals(i, n) {
        let id = new Array();
        id = ['mood', 'message_input']
        document.getElementById(id[n]).value += String.fromCodePoint(emojis_animals[i])
    }

</script>
<script src="https://yastatic.net/jquery/3.3.1/jquery.min.js"></script>
<script>
    function send_form(){

        var name = document.forms.userForm.name.value;
        var surname = document.forms.userForm.surname.value;
        var mood = document.forms.userForm.mood.value;
        var info = document.forms.userForm.info.value;
        var token = document.forms.userForm.authenticity_token.value;
        var contact = document.forms.userForm.contact.value;
        var value = document.forms.userForm.value.value;

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/update.json");
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

        body = 'name=' + encodeURIComponent(name) +
            '&surname=' + encodeURIComponent(surname) +
            '&mood=' + encodeURIComponent(mood) +
            '&info=' + encodeURIComponent(info) +
            '&authenticity_token=' + encodeURIComponent(token) +
            '&contact=' + encodeURIComponent(contact) +
            '&value=' + encodeURIComponent(value);

        xhr.onreadystatechange = function (){
            if (xhr.readyState == 4 && xhr.status == 200) {
                document.getElementById("alert").innerHTML = xhr.responseText;
            }
        }
        xhr.send(body)
    }
</script>
